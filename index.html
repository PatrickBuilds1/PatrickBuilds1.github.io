<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Personalized Convo Bot - AI-Powered Messaging Assistant</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      
      :root {
        /* Dark Theme Variables (Default) */
        --bg-primary: #181818;
        --bg-secondary: #1f1f1f;
        --bg-tertiary: #2a2a2a;
        --accent-primary: #7d5fff;
        --accent-secondary: #5e72eb;
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
        --text-tertiary: #888888;
        --danger: #ff5e5e;
        --success: #5e9dff; /* Changed from lime green to blue-ish */
        --warning: #ffce5e;
        --info: #5eceff;
        --neutral: #5e8fff;
        --witty: #ff5ece;
        --charming: #5effce;
        --personalized: #ce5eff;
        --structure: #ff8f5e; /* New color for message structure */
        --flow: #42c6ff; /* New color for conversation flow */
        --toast-success: #5e9dff; /* Changed from lime green to blue-ish */
        --toast-error: #ff5e5e;
        --toast-info: rgba(0, 0, 0, 0.8);
        --user-message-bg: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        --bot-message-bg: #444444;

        --radius-sm: 6px;
        --radius-md: 12px;
        --radius-lg: 18px;

        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);

        --transition-fast: 0.15s ease;
        --transition-normal: 0.3s ease;
        --transition-slow: 0.4s ease;

        --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        
        /* Standard button styles */
        --btn-padding: 0.6rem 1rem;
        --btn-font-size: 0.85rem;
        --btn-font-weight: 600;
      }

      /* Light Theme Class */
      .light-mode {
        /* Light background colors */
        --bg-primary: #f9f9f9;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f0f0f0;

        /* Light text colors */
        --text-primary: #333333;
        --text-secondary: #555555;
        --text-tertiary: #808080;

        /* Lighter shadows */
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
        
        /* Light mode message colors */
        --user-message-bg: #007aff;
        --bot-message-bg: #e5e5ea;
        
        /* Light mode toast colors - changed to be theme-consistent */
        --toast-success: #007aff;
        --toast-error: #FF3B30;
        --toast-info: rgba(50, 50, 50, 0.9);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: var(--font-primary);
      }

      body {
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
      }

      header {
        padding: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: rgba(0, 0, 0, 0.75);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }
      .light-mode header {
        background-color: rgba(245, 245, 245, 0.9);
        border-bottom: 1px solid #cccccc;
      }

      .logo {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }

      .logo-main {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-md);
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow-sm);
      }
      
      .logo-text a {
        font-weight: 700;
        font-size: 1.4rem;
        background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-decoration: none;
      }
      
      .logo-text a:hover {
        opacity: 0.8;
      }
      
      .tagline {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-left: 2.5rem;
        margin-top: 0.2rem;
        font-style: italic;
      }

      .header-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      
      /* Standardized button styles */
      .btn {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: var(--btn-padding);
        border-radius: var(--radius-md);
        font-weight: var(--btn-font-weight);
        font-size: var(--btn-font-size);
        cursor: pointer;
        transition: all var(--transition-normal);
      }
      .btn:hover {
        background: rgba(125, 95, 255, 0.15);
      }
      .light-mode .btn {
        background: #eeeeee;
        color: #333333;
        border: 1px solid #cccccc;
      }
      .light-mode .btn:hover {
        background: #ddd;
      }
      
      .btn-primary {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: var(--text-primary);
        border: none;
      }
      .light-mode .btn-primary {
        background: #007aff;
        color: #ffffff;
      }
      .btn-primary:hover {
        opacity: 0.9;
      }
      
      .header-actions button {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: var(--btn-padding);
        border-radius: var(--radius-md);
        font-weight: var(--btn-font-weight);
        font-size: var(--btn-font-size);
        cursor: pointer;
        transition: all var(--transition-normal);
      }
      .header-actions button:hover {
        background: rgba(125, 95, 255, 0.15);
      }
      .light-mode .header-actions button {
        background: #eeeeee;
        color: #333333;
        border: 1px solid #cccccc;
      }
      .light-mode .header-actions button:hover {
        background: #ddd;
      }

      #theme-toggle::before {
        content: "Theme";
      }
      #help-toggle::before {
        content: "Help";
      }
      #upload-button {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: var(--text-primary);
      }
      #upload-button::before {
        content: "Upload";
        margin-right: 0.5rem;
      }
      .light-mode #upload-button {
        background: #007aff;
        color: #ffffff;
        border: none;
      }

      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
      }

      section {
        border-radius: var(--radius-lg);
        background: var(--bg-secondary);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        margin-bottom: 1.5rem;
      }
      section:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      /* Enhanced section header with gradient background */
      .section-header {
        padding: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(90deg, rgba(125, 95, 255, 0.2), rgba(94, 114, 235, 0.1));
      }
      .light-mode .section-header {
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        background: linear-gradient(90deg, rgba(0, 122, 255, 0.1), rgba(94, 114, 235, 0.05));
      }
      
      /* Enhanced section title */
      .section-title {
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: -0.5px;
        position: relative;
      }
      
      .section-title::after {
        content: '';
        position: absolute;
        bottom: -6px;
        left: 0;
        width: 40px;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        border-radius: 3px;
      }
      
      .section-content {
        padding: 1.5rem;
      }

      /* Enhanced intro text */
      .intro-text {
        margin-bottom: 1.5rem;
        font-size: 1rem;
        color: var(--text-secondary);
        line-height: 1.7;
        background: rgba(125, 95, 255, 0.05);
        padding: 1.5rem;
        border-radius: var(--radius-md);
        border-left: 4px solid var(--accent-primary);
      }
      
      .intro-text strong {
        color: var(--text-primary);
        font-weight: 600;
      }

      /* Export instructions with improved formatting */
      .export-instructions {
        margin: 1.5rem 0;
        padding: 1rem;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        border-left: 4px solid var(--accent-primary);
      }
      
      .export-instructions h3 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-size: 1rem;
      }
      
      .export-instructions p {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
      }

      .drag-area {
        border: 2px dashed rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: 3rem 2rem;
        text-align: center;
        transition: all var(--transition-normal);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        min-height: 240px;
      }
      .light-mode .drag-area {
        border: 2px dashed rgba(0, 0, 0, 0.1);
      }
      .drag-area:hover,
      .drag-area.active {
        border-color: var(--accent-primary);
        background: rgba(125, 95, 255, 0.05);
      }
      .drag-icon {
        width: 64px;
        height: 64px;
        fill: currentColor;
        opacity: 0.8;
        transition: all var(--transition-normal);
      }
      .drag-text {
        font-size: 1.2rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        transition: all var(--transition-normal);
      }
      .drag-hint {
        font-size: 0.9rem;
        color: var(--text-tertiary);
      }

      /* Sample Analysis Button */
      .sample-analysis-container {
        display: flex;
        justify-content: center;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
      }

      .sample-analysis-button {
        background: var(--accent-primary);
        color: white;
        border: none;
        padding: 0.75rem 1.25rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all var(--transition-normal);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: var(--shadow-sm);
      }

      .sample-analysis-button:hover {
        background: var(--accent-secondary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .sample-analysis-button svg {
        width: 20px;
        height: 20px;
      }

      .or-divider {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
        color: var(--text-tertiary);
        font-size: 0.9rem;
      }

      .or-divider::before,
      .or-divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
        margin: 0 1rem;
      }

      .light-mode .or-divider::before,
      .light-mode .or-divider::after {
        background: rgba(0, 0, 0, 0.1);
      }

      .file-info {
        margin-top: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        width: 100%;
        max-width: 400px;
      }
      .file-icon {
        width: 24px;
        height: 24px;
        fill: currentColor;
      }
      .file-name {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .file-remove {
        color: var(--danger);
        cursor: pointer;
        width: 20px;
        height: 20px;
        fill: currentColor;
        transition: all var(--transition-fast);
      }
      .file-remove:hover {
        transform: scale(1.1);
      }

      .analyze-button {
        margin-top: 1.5rem;
        width: 100%;
        max-width: 400px;
        padding: 0.75rem;
        font-size: 1rem;
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: var(--text-primary);
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
      }
      .light-mode .analyze-button {
        background: #007aff; /* iOS-style button color in light mode */
        color: #fff;
      }
      .analyze-button .spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: rotate 1s linear infinite;
        position: absolute;
        right: 1.2rem;
      }
      .analyzing .spinner {
        display: block;
      }
      .analyzing .btn-text {
        opacity: 0.7;
      }

      .results {
        display: none;
        flex-direction: column;
        gap: 1rem; /* Reduced gap to close spacing */
      }
      .results.active {
        display: flex;
      }

      .result-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .result-card {
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .light-mode .result-card {
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      .result-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }
      .result-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .result-icon {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        fill: currentColor;
      }
      .result-title {
        font-size: 1.1rem;
        font-weight: 600;
      }
      .progress-bar {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
      }
      .light-mode .progress-bar {
        background: rgba(0, 0, 0, 0.1);
      }
      .progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width var(--transition-slow);
      }
      .result-value {
        font-size: 2rem;
        font-weight: 700;
        margin: 0.5rem 0;
      }
      .result-description {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
      }

      .personality-icon {
        background: linear-gradient(135deg, var(--info), var(--neutral));
      }
      .pattern-icon {
        background: linear-gradient(135deg, var(--warning), var(--danger));
      }
      .sentiment-icon {
        background: linear-gradient(135deg, var(--success), var(--info));
      }
      .emoji-icon {
        background: linear-gradient(135deg, var(--witty), var(--charming));
      }
      .structure-icon {
        background: linear-gradient(135deg, var(--structure), #ff6b2b);
      }
      .flow-icon {
        background: linear-gradient(135deg, var(--flow), #3e97ff);
      }

      .response-modes {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
      .mode-card {
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        cursor: pointer;
        transition: all var(--transition-normal);
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }
      .mode-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        opacity: 0;
        transition: opacity var(--transition-normal);
        pointer-events: none;
      }
      .light-mode .mode-card::after {
        background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.05), transparent);
      }
      .mode-card:hover::after {
        opacity: 1;
        animation: shimmer 2s infinite;
      }
      .mode-card.active {
        border-color: var(--accent-primary);
        box-shadow: 0 0 15px rgba(125, 95, 255, 0.3);
      }
      .mode-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .mode-icon {
        width: 42px;
        height: 42px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        fill: currentColor;
      }
      .mode-title {
        font-size: 1.1rem;
        font-weight: 600;
      }
      .mode-description {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
      }
      .personalized-icon {
        background: linear-gradient(135deg, var(--personalized), #ab46cc);
      }
      .charming-icon {
        background: linear-gradient(135deg, var(--charming), #46ccab);
      }
      .neutral-icon {
        background: linear-gradient(135deg, var(--neutral), #4671cc);
      }
      .witty-icon {
        background: linear-gradient(135deg, var(--witty), #cc46ab);
      }

      /* Suggestion buttons */
      .suggestion-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .suggestion-button {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: 0.8rem 1.2rem;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all var(--transition-normal);
        flex: 1;
        min-width: 200px;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .suggestion-button:hover {
        background: rgba(125, 95, 255, 0.1);
        border-color: var(--accent-primary);
      }

      .suggestion-button svg {
        width: 18px;
        height: 18px;
        color: var(--accent-primary);
        flex-shrink: 0;
      }

      .light-mode .suggestion-button {
        background: #f5f5f5;
        border-color: #e0e0e0;
      }

      .light-mode .suggestion-button:hover {
        background: rgba(0, 122, 255, 0.05);
        border-color: #007aff;
      }

      /* Chat controls container - for input and buttons */
      .chat-controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-top: 1rem;
      }
      
      /* Clear chat button styling */
      #clear-chat {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all var(--transition-normal);
      }
      
      #clear-chat:hover {
        background: rgba(255, 94, 94, 0.15);
        color: var(--danger);
      }
      
      .light-mode #clear-chat {
        background: #eeeeee;
        border: 1px solid #cccccc;
      }
      
      .light-mode #clear-chat:hover {
        background: rgba(255, 59, 48, 0.1);
        color: #FF3B30;
      }

      /* Chat input area with gap between input and button */
      .query-input {
        display: flex;
        align-items: center;
        background: var(--bg-tertiary);
        padding: 1rem;
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
        margin-top: 1rem;
        gap: 0.75rem; /* Added gap between input and button */
        flex: 1;
      }
      .message-input {
        flex: 1;
        background: var(--bg-tertiary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: 0.75rem 1rem;
        color: var(--text-primary);
        font-size: 0.9rem;
        text-align: left;
        resize: vertical;
        overflow-y: auto;
        min-height: 48px;
        transition: all var(--transition-normal);
      }
      .light-mode .message-input {
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      .message-input:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(125, 95, 255, 0.2);
      }
      .send-button {
        padding: 0.75rem 1.25rem;
        border-radius: var(--radius-md);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: var(--text-primary);
        border: none;
        cursor: pointer;
        min-width: 80px;
      }
      .light-mode .send-button {
        background: #007aff;
        color: #ffffff;
      }
      .send-button span {
        font-size: 0.9rem;
      }

      /* Chat bubbles styled like iMessage */
      #conversation-history {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        max-height: 250px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        display: none; /* Hidden by default until first message */
      }
      #conversation-history.active {
        display: flex;
      }
      .message {
        margin-bottom: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: 18px;
        max-width: 75%;
        line-height: 1.4;
        word-wrap: break-word;
      }
      .user-message {
        background: var(--user-message-bg);
        color: #fff;
        align-self: flex-end; /* Position on right */
        border-bottom-right-radius: 4px; /* iMessage style */
      }
      .bot-message {
        background: var(--bot-message-bg);
        align-self: flex-start; /* Position on left */
        color: var(--text-primary);
        border-bottom-left-radius: 4px; /* iMessage style */
      }
      .light-mode .bot-message {
        color: #333333;
      }

      /* Settings Panel with consistent margin */
      .settings-panel {
        display: none;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        padding: 1rem 1.5rem;
        border-radius: var(--radius-md);
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-normal);
      }
      .settings-panel.active {
        display: block;
      }
      .settings-panel h3 {
        margin-bottom: 1rem;
        font-size: 1rem;
        color: var(--text-secondary);
        text-align: center;
      }
      .slider-container {
        width: 100%;
        margin-bottom: 1.5rem;
      }
      .slider-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.1);
        outline: none;
        transition: background var(--transition-normal);
      }
      .light-mode .slider {
        background: rgba(0, 0, 0, 0.1);
      }
      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
        transition: all var(--transition-normal);
        border: 2px solid var(--bg-tertiary);
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }
      .slider::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
        transition: all var(--transition-normal);
        border: 2px solid var(--bg-tertiary);
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }
      .slider:hover::-webkit-slider-thumb {
        transform: scale(1.1);
        box-shadow: 0 0 10px rgba(125, 95, 255, 0.4);
      }
      .slider:hover::-moz-range-thumb {
        transform: scale(1.1);
        box-shadow: 0 0 10px rgba(125, 95, 255, 0.4);
      }

      /* Toast notifications with theme-consistent colors */
      #toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 200;
      }
      .toast {
        padding: 0.75rem 1rem;
        margin-top: 10px;
        border-radius: var(--radius-md);
        opacity: 0;
        animation: fadeIn 0.5s forwards;
        color: var(--text-primary);
      }
      
      .toast.success {
        background: var(--toast-success);
        color: #fff;
      }
      
      .toast.error {
        background: var(--toast-error);
        color: #fff;
      }
      
      .toast.info {
        background: var(--toast-info);
        color: #fff;
      }

      footer {
        text-align: center;
        padding: 1.5rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        margin-top: 2rem;
      }
      
      .light-mode footer {
        border-top: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      .privacy-notice {
        margin-top: 0.5rem;
        font-size: 0.75rem;
        line-height: 1.4;
        color: var(--text-tertiary);
        max-width: 600px;
        margin: 0.5rem auto 0 auto;
      }
      
      .creator {
        font-size: 0.75rem;
        color: var(--text-tertiary);
        margin-top: 0.5rem;
      }

      /* Help Modal styled to match the screenshot */
      #help-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
      }
      .light-mode #help-modal {
        background: rgba(0, 0, 0, 0.4);
      }
      #help-modal.active {
        display: flex;
      }
      #help-modal .modal-content {
        background: var(--bg-secondary);
        padding: 2.5rem;
        border-radius: var(--radius-md);
        max-width: 550px;
        width: 90%;
        box-shadow: var(--shadow-lg);
        text-align: center;
      }
      
      #help-modal h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 2rem;
      }
      
      #help-modal ul {
        list-style: none;
        text-align: center;
        margin-bottom: 2rem;
      }
      
      #help-modal li {
        margin-bottom: 1rem;
        font-size: 1.1rem;
        line-height: 1.5;
        color: var(--text-secondary);
      }
      
      #help-modal .close-btn {
        display: inline-block;
        padding: 0.8rem 2.5rem;
        background: #7d5fff;
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      #help-modal .close-btn:hover {
        opacity: 0.9;
      }

      /* Media Queries for Responsive Layout */
      @media (max-width: 768px) {
        header {
          flex-direction: column;
          gap: 1rem;
        }
        
        .header-actions {
          width: 100%;
          justify-content: space-between;
        }
        
        .query-input {
          flex-direction: column;
          gap: 0.75rem;
        }
        
        .message-input {
          width: 100%;
        }
        
        .send-button {
          width: 100%;
        }
        
        .tagline {
          margin-left: 0;
          text-align: center;
          margin-top: 0.5rem;
        }
        
        .chat-controls {
          flex-direction: column;
        }
        
        #clear-chat {
          width: 100%;
        }
        
        #help-modal .modal-content {
          padding: 1.5rem;
          width: 95%;
        }
        
        .suggestion-buttons {
          flex-direction: column;
        }
        
        .suggestion-button {
          width: 100%;
        }
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }
      @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">
        <div class="logo-main">
          <div class="logo-icon">
            <svg class="icon" viewBox="0 0 24 24">
              <path
                d="M12 3c1.5 0 2.25 0 3 1.5 0.75 1.5 0.75 1.5 1.5 3 0.75-1.5 0.75-1.5 1.5-3 0.75-1.5 1.5-1.5 3-1.5-1.5 0-2.25 0-3-1.5-0.75-1.5-0.75-1.5-1.5-3-0.75 1.5-0.75 1.5-1.5 3-0.75 1.5-1.5 1.5-3 1.5z"
              ></path>
              <path
                d="M12 9c1 0 1.5 0 2 1 0.5 1 0.5 1 1 2 0.5-1 0.5-1 1-2 0.5-1 1-1 2-1-1.5 0-1.5 0-2 1z"
              ></path>
              <path
                d="M5.5 16c0.828 0 1.5 0.672 1.5 1.5s-0.672 1.5-1.5 1.5-1.5-0.672-1.5-1.5 0.672-1.5 1.5-1.5z"
              ></path>
            </svg>
          </div>
          <div class="logo-text">
            <a href="#upload-section">Personalized Convo Bot</a>
          </div>
        </div>
        <div class="tagline">Be you, even when you're not there.</div>
      </div>
      <div class="header-actions">
        <button id="theme-toggle" class="btn"></button>
        <button id="help-toggle" class="btn"></button>
        <button id="upload-button" class="btn btn-primary"></button>
      </div>
    </header>

    <main>
      <section id="upload-section">
        <div class="section-header">
          <h2 class="section-title">Message Analysis</h2>
        </div>
        <div class="section-content">
          <p class="intro-text">
            <strong>Personalized Convo Bot</strong> uses advanced AI to analyze your communication patterns and respond exactly like you would. 
            Upload your messages, emails, or any text conversations to create a <strong>digital twin</strong> that captures your unique tone, 
            style, humor, and personality traits. Whether you need help with customer responses, want to maintain connections 
            during busy periods, or simply curious about your communication style, our tool gives you insights while 
            preserving your authentic voice.
          </p>

          <!-- Improved export instructions with better formatting -->
          <div class="export-instructions">
            <h3>How to Export iMessage Data:</h3>
            <p>
              Open the Messages app on your Mac, select a conversation, then go to "File → Print." From the print dialog, select "Save as PDF" or export as text. 
              Upload that file here for analysis.
            </p>
          </div>

          <div class="drag-area" id="drop-zone">
            <svg class="drag-icon" viewBox="0 0 24 24">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <h3 class="drag-text">Drag & Drop your files here</h3>
            <p class="drag-hint">or click to browse</p>
            <input type="file" id="file-input" style="display: none;" />
          </div>
          
          <!-- Sample Analysis Button -->
          <div class="or-divider">OR</div>
          <div class="sample-analysis-container">
            <button id="sample-analysis-button" class="sample-analysis-button">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
              </svg>
              Try Sample Analysis
            </button>
          </div>

          <div id="file-info-container" style="display: none;">
            <div class="file-info">
              <svg class="file-icon" viewBox="0 0 24 24">
                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                <polyline points="13 2 13 9 20 9"></polyline>
              </svg>
              <span class="file-name" id="file-name">messages.csv</span>
              <svg class="file-remove" id="remove-file" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </div>
            <button class="analyze-button btn btn-primary" id="analyze-button">
              <span class="btn-text">Analyze Messages</span>
              <div class="spinner"></div>
            </button>
          </div>
        </div>
      </section>

      <div class="results" id="results">
        <section id="analysis-section">
          <div class="section-header">
            <h2 class="section-title">Analysis Results</h2>
          </div>
          <div class="section-content">
            <div class="result-grid">
              <!-- Personality Card -->
              <div class="result-card">
                <div class="result-header">
                  <div class="result-icon personality-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                      <circle cx="9" cy="7" r="4"></circle>
                      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                  </div>
                  <h3 class="result-title">Personality</h3>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 78%; background: linear-gradient(to right, var(--info), var(--neutral));"></div>
                </div>
                <div class="result-value">Friendly</div>
                <p class="result-description">
                  Your messaging style appears warm and approachable. You use positive language, ask questions, and engage meaningfully in conversations.
                </p>
              </div>

              <!-- Response Pattern Card -->
              <div class="result-card">
                <div class="result-header">
                  <div class="result-icon pattern-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                  </div>
                  <h3 class="result-title">Response Pattern</h3>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 65%; background: linear-gradient(to right, var(--warning), var(--danger));"></div>
                </div>
                <div class="result-value">Quick</div>
                <p class="result-description">
                  You typically respond within 15 minutes during active conversations. Your messages tend to be concise but thoughtful.
                </p>
              </div>

              <!-- Sentiment Card -->
              <div class="result-card">
                <div class="result-header">
                  <div class="result-icon sentiment-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                      <line x1="9" y1="9" x2="9.01" y2="9"></line>
                      <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                  </div>
                  <h3 class="result-title">Sentiment</h3>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 82%; background: linear-gradient(to right, var(--success), var(--info));"></div>
                </div>
                <div class="result-value">Positive</div>
                <p class="result-description">
                  Your messages convey a consistently positive tone. You frequently use encouraging words and supportive language.
                </p>
              </div>

              <!-- Emoji Usage Card -->
              <div class="result-card">
                <div class="result-header">
                  <div class="result-icon emoji-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                      <line x1="9" y1="9" x2="9.01" y2="9"></line>
                      <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                  </div>
                  <h3 class="result-title">Emoji Usage</h3>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 45%; background: linear-gradient(to right, var(--witty), var(--charming));"></div>
                </div>
                <div class="result-value">Moderate</div>
                <p class="result-description">
                  You use emojis selectively to emphasize points. Most commonly used: 😊, 👍, and 😂.
                </p>
              </div>
              
              <!-- Message Structure Card - NEW -->
              <div class="result-card">
                <div class="result-header">
                  <div class="result-icon structure-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <line x1="8" y1="6" x2="21" y2="6"></line>
                      <line x1="8" y1="12" x2="21" y2="12"></line>
                      <line x1="8" y1="18" x2="21" y2="18"></line>
                      <line x1="3" y1="6" x2="3.01" y2="6"></line>
                      <line x1="3" y1="12" x2="3.01" y2="12"></line>
                      <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                  </div>
                  <h3 class="result-title">Message Structure</h3>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 70%; background: linear-gradient(to right, var(--structure), #ff6b2b);"></div>
                </div>
                <div class="result-value">Concise</div>
                <p class="result-description">
                  You tend to write in short, focused paragraphs. Your messages have a clear structure that makes your points easy to follow.
                </p>
              </div>
              
              <!-- Conversation Flow Card - NEW -->
              <div class="result-card">
                <div class="result-header">
                  <div class="result-icon flow-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <polyline points="17 1 21 5 17 9"></polyline>
                      <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                      <polyline points="7 23 3 19 7 15"></polyline>
                      <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                    </svg>
                  </div>
                  <h3 class="result-title">Conversation Flow</h3>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 85%; background: linear-gradient(to right, var(--flow), #3e97ff);"></div>
                </div>
                <div class="result-value">Connective</div>
                <p class="result-description">
                  You naturally guide conversations with smooth transitions between topics. You often build on previous messages rather than abruptly changing subjects.
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- Modes section with consistent styling -->
        <section id="modes-section">
          <div class="section-header">
            <h2 class="section-title">Response Modes</h2>
            <button class="btn" id="toggle-settings">
              Settings
            </button>
          </div>
          <div class="section-content">
            <div class="settings-panel" id="settings-panel">
              <h3>Response Settings</h3>
              <div class="slider-container">
                <div class="slider-label">
                  <span class="slider-title">Response Length</span>
                  <span class="slider-value" id="length-value">Medium</span>
                </div>
                <input type="range" min="1" max="5" value="3" class="slider" id="length-slider" />
              </div>
              <div class="slider-container">
                <div class="slider-label">
                  <span class="slider-title">Creativity Level</span>
                  <span class="slider-value" id="creativity-value">Balanced</span>
                </div>
                <input type="range" min="1" max="5" value="3" class="slider" id="creativity-slider" />
              </div>
            </div>

            <div class="response-modes">
              <div class="mode-card active" data-mode="personalized">
                <div class="mode-header">
                  <h3 class="mode-title">Personalized</h3>
                  <div class="mode-icon personalized-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                      <circle cx="9" cy="7" r="4"></circle>
                      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                  </div>
                </div>
                <p class="mode-description">
                  Responses that match your exact texting style and personality.
                </p>
              </div>

              <div class="mode-card" data-mode="charming">
                <div class="mode-header">
                  <h3 class="mode-title">Charming</h3>
                  <div class="mode-icon charming-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                      ></path>
                    </svg>
                  </div>
                </div>
                <p class="mode-description">
                  Warm, engaging responses with a friendly and approachable tone.
                </p>
              </div>

              <div class="mode-card" data-mode="neutral">
                <div class="mode-header">
                  <h3 class="mode-title">Neutral</h3>
                  <div class="mode-icon neutral-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                  </div>
                </div>
                <p class="mode-description">
                  Clear, straightforward responses without added flair or personality.
                </p>
              </div>

              <div class="mode-card" data-mode="witty">
                <div class="mode-header">
                  <h3 class="mode-title">Witty</h3>
                  <div class="mode-icon witty-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                      <line x1="9" y1="9" x2="9.01" y2="9"></line>
                      <line x1="15" y1="9" x2="15.01" y2="9"></line>
                    </svg>
                  </div>
                </div>
                <p class="mode-description">
                  Clever, humorous responses with a touch of playful personality.
                </p>
              </div>
            </div>
            
            <!-- Suggestion Buttons -->
            <div class="suggestion-buttons">
              <button class="suggestion-button" id="suggestion-email">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                  <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
                How would I respond to this email?
              </button>
              <button class="suggestion-button" id="suggestion-dinner">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                  <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                  <line x1="6" y1="1" x2="6" y2="4"></line>
                  <line x1="10" y1="1" x2="10" y2="4"></line>
                  <line x1="14" y1="1" x2="14" y2="4"></line>
                </svg>
                Write a message about dinner plans
              </button>
              <button class="suggestion-button" id="suggestion-professional">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
                Draft a professional message for me
              </button>
            </div>

            <div class="chat-controls">
              <div class="query-input">
                <textarea
                  class="message-input"
                  id="message-input"
                  placeholder="Type a message to get a response..."
                ></textarea>
                <button class="send-button btn btn-primary" id="send-button">
                  <span>Send</span>
                </button>
              </div>
              <button id="clear-chat" class="btn">Clear Chat</button>
            </div>

            <div id="conversation-history"></div>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div id="version-display"></div>
      <div class="privacy-notice">
        Your messages are processed locally and never shared with third parties. We respect your privacy.
      </div>
      <div class="creator">Site created by Patrick Hall.</div>
    </footer>

    <div id="toast-container"></div>

    <!-- Help Modal - Modified to match the screenshot -->
    <div id="help-modal">
      <div class="modal-content">
        <h2>Welcome to Personalized Convo Bot!</h2>
        <ul>
          <li>• Upload your message file using the Analysis section.</li>
          <li>• Your conversation history appears in the chat area.</li>
          <li>• Type your message and hit Send to get a response that matches your style.</li>
          <li>• Adjust response length and creativity in Settings.</li>
          <li>• Use the Clear Chat button to reset your conversation.</li>
        </ul>
        <button class="close-btn" id="close-help">Close</button>
      </div>
    </div>

    <script>
      const API_KEY = "";
      const VERSION = "1.0.12";

      document.addEventListener("DOMContentLoaded", function () {
        const dropZone = document.getElementById("drop-zone");
        const fileInput = document.getElementById("file-input");
        const fileInfoContainer = document.getElementById("file-info-container");
        const fileName = document.getElementById("file-name");
        const removeFile = document.getElementById("remove-file");
        const analyzeButton = document.getElementById("analyze-button");
        const sampleAnalysisButton = document.getElementById("sample-analysis-button");
        const results = document.getElementById("results");
        const themeToggle = document.getElementById("theme-toggle");
        const helpToggle = document.getElementById("help-toggle");
        const helpModal = document.getElementById("help-modal");
        const closeHelp = document.getElementById("close-help");
        const uploadButton = document.getElementById("upload-button");
        const conversationHistoryDiv = document.getElementById("conversation-history");
        const versionDisplay = document.getElementById("version-display");
        const modeCards = document.querySelectorAll(".mode-card");
        const messageInput = document.getElementById("message-input");
        const sendButton = document.getElementById("send-button");
        const settingsPanel = document.getElementById("settings-panel");
        const toggleSettings = document.getElementById("toggle-settings");
        const clearChatButton = document.getElementById("clear-chat");

        // Suggestion buttons
        const suggestionEmail = document.getElementById("suggestion-email");
        const suggestionDinner = document.getElementById("suggestion-dinner");
        const suggestionProfessional = document.getElementById("suggestion-professional");

        // Sliders for length & creativity
        const lengthSlider = document.getElementById("length-slider");
        const lengthValue = document.getElementById("length-value");
        const creativitySlider = document.getElementById("creativity-slider");
        const creativityValue = document.getElementById("creativity-value");

        let conversationHistory = [];

        // Toast function with theme-consistent colors
        function showToast(message, type = "info") {
          const container = document.getElementById("toast-container");
          const toast = document.createElement("div");
          toast.className = `toast ${type}`;
          toast.textContent = message;
          container.appendChild(toast);

          setTimeout(() => {
            toast.style.opacity = 0;
            toast.style.transition = "opacity 0.5s";
          }, 3000);
          setTimeout(() => {
            container.removeChild(toast);
          }, 3500);
        }

        // Display version
        versionDisplay.textContent = "Version: " + VERSION;

        // Show help modal first time
        if (!localStorage.getItem("visited")) {
          helpModal.classList.add("active");
        }

        // Theme toggle
        themeToggle.addEventListener("click", () => {
          document.body.classList.toggle("light-mode");
          showToast("Theme toggled", "info");
        });

        // Help modal
        helpToggle.addEventListener("click", () => {
          helpModal.classList.add("active");
        });
        closeHelp.addEventListener("click", () => {
          helpModal.classList.remove("active");
          localStorage.setItem("visited", "true");
        });

        // Drag & drop upload
        dropZone.addEventListener("click", () => {
          fileInput.click();
        });
        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          dropZone.classList.add("active");
        });
        dropZone.addEventListener("dragleave", () => {
          dropZone.classList.remove("active");
        });
        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          dropZone.classList.remove("active");
          if (e.dataTransfer.files.length) {
            handleFiles(e.dataTransfer.files);
          }
        });
        fileInput.addEventListener("change", handleFileSelect);

        function handleFileSelect(e) {
          if (e.target.files.length) {
            handleFiles(e.target.files);
          }
        }
        function handleFiles(files) {
          const file = files[0];
          fileName.textContent = file.name;
          fileInfoContainer.style.display = "flex";
          fileInfoContainer.style.flexDirection = "column";
          fileInfoContainer.style.alignItems = "center";
          dropZone.style.display = "none";
          showToast("File uploaded", "success");
        }
        removeFile.addEventListener("click", () => {
          fileInput.value = "";
          fileInfoContainer.style.display = "none";
          dropZone.style.display = "flex";
        });
        uploadButton.addEventListener("click", () => {
          fileInput.click();
        });

        // Sample Analysis button
        sampleAnalysisButton.addEventListener("click", () => {
          showToast("Running sample analysis...", "info");
          setTimeout(() => {
            results.classList.add("active");
            results.scrollIntoView({ behavior: "smooth" });
            showToast("Sample analysis complete", "success");
          }, 1500);
        });

        // Analyze
        analyzeButton.addEventListener("click", () => {
          analyzeButton.classList.add("analyzing");
          setTimeout(() => {
            analyzeButton.classList.remove("analyzing");
            results.classList.add("active");
            results.scrollIntoView({ behavior: "smooth" });
            showToast("Analysis complete", "success");
          }, 2000);
        });

        // Mode selection
        modeCards.forEach((card) => {
          card.addEventListener("click", () => {
            modeCards.forEach((c) => c.classList.remove("active"));
            card.classList.add("active");
          });
        });

        // Toggle settings
        toggleSettings.addEventListener("click", () => {
          settingsPanel.classList.toggle("active");
        });

        // Update conversation - iMessage style bubbles
        function updateConversationHistory() {
          conversationHistoryDiv.innerHTML = "";
          conversationHistory.forEach((msg) => {
            const msgDiv = document.createElement("div");
            msgDiv.className = "message " + (msg.role === "user" ? "user-message" : "bot-message");
            msgDiv.textContent = msg.content;
            conversationHistoryDiv.appendChild(msgDiv);
          });
          conversationHistoryDiv.scrollTop = conversationHistoryDiv.scrollHeight;
        }

        // Clear chat functionality
        clearChatButton.addEventListener("click", () => {
          conversationHistory = [];
          conversationHistoryDiv.innerHTML = "";
          conversationHistoryDiv.classList.remove("active");
          showToast("Chat cleared", "info");
        });

        // Handle suggestion clicks
        suggestionEmail.addEventListener("click", () => {
          messageInput.value = "How would I respond to this email?";
          sendMessage();
        });

        suggestionDinner.addEventListener("click", () => {
          messageInput.value = "Write a message about dinner plans";
          sendMessage();
        });

        suggestionProfessional.addEventListener("click", () => {
          messageInput.value = "Draft a professional message for me";
          sendMessage();
        });

        // Send message
        async function sendMessage() {
          const userMessage = messageInput.value.trim();
          if (!userMessage) return;

          // Show conversation history if this is the first message
          if (!conversationHistory.length) {
            conversationHistoryDiv.classList.add("active");
          }

          conversationHistory.push({ role: "user", content: userMessage });
          updateConversationHistory();
          messageInput.value = "";

          const activeMode = document.querySelector(".mode-card.active").dataset.mode;
          if (conversationHistory.length === 1) {
            conversationHistory.unshift({
              role: "system",
              content: "You are a helpful assistant with a " + activeMode + " tone.",
            });
          }
          if (!API_KEY) {
            showToast("No API key available.", "error");
            return;
          }
          showToast("Sending message...", "info");

          // Map slider to temperature
          const creativityVal = parseInt(creativitySlider.value);
          let temperature;
          switch (creativityVal) {
            case 1: temperature = 0.2; break;
            case 2: temperature = 0.4; break;
            case 3: temperature = 0.7; break;
            case 4: temperature = 0.9; break;
            case 5: temperature = 1.0; break;
            default: temperature = 0.7;
          }

          try {
            const response = await fetch("https://api.openai.com/v1/chat/completions", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + API_KEY,
              },
              body: JSON.stringify({
                model: "gpt-4",
                messages: conversationHistory,
                temperature
              }),
            });
            const data = await response.json();
            if (response.ok) {
              const botMessage = data.choices[0].message.content.trim();
              conversationHistory.push({ role: "assistant", content: botMessage });
              updateConversationHistory();
              showToast("Response received", "success");
            } else {
              const errorMsg = data.error?.message || "Error communicating with API.";
              conversationHistory.push({ role: "assistant", content: "Error: " + errorMsg });
              updateConversationHistory();
              showToast("Error: " + errorMsg, "error");
            }
          } catch (error) {
            conversationHistory.push({ role: "assistant", content: "Error: " + error.message });
            updateConversationHistory();
            showToast("Error: " + error.message, "error");
          }
        }

        sendButton.addEventListener("click", sendMessage);
        messageInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        });

        // Slider label updates
        lengthSlider.addEventListener("input", () => {
          const value = lengthSlider.value;
          let text;
          switch (value) {
            case "1": text = "Very Short"; break;
            case "2": text = "Short"; break;
            case "3": text = "Medium"; break;
            case "4": text = "Long"; break;
            case "5": text = "Very Long"; break;
          }
          lengthValue.textContent = text;
        });

        creativitySlider.addEventListener("input", () => {
          const value = creativitySlider.value;
          let text;
          switch (value) {
            case "1": text = "Very Low"; break;
            case "2": text = "Low"; break;
            case "3": text = "Balanced"; break;
            case "4": text = "High"; break;
            case "5": text = "Very High"; break;
          }
          creativityValue.textContent = text;
        });
      });
    </script>
  </body>
</html>
